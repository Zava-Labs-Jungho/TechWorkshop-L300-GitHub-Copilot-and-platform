# Build & Deploy Workflow

The `build-deploy.yml` workflow builds the Zava Storefront Docker image using Azure Container Registry and deploys it to Azure App Service. It triggers on pushes to `main` that change files under `src/`, or via manual dispatch.

## Prerequisites

- An Azure App Registration (service principal) with **federated credentials** configured for GitHub Actions OIDC on this repository.
- The service principal needs the following role assignments:
  - **AcrPush** on the Azure Container Registry
  - **Contributor** (or **Website Contributor**) on the App Service

## GitHub Secrets

Configure these under **Settings → Secrets and variables → Actions → Secrets**:

| Secret | Description |
|---|---|
| `AZURE_CLIENT_ID` | Application (client) ID of the Azure AD app registration |
| `AZURE_TENANT_ID` | Azure AD tenant ID |
| `AZURE_SUBSCRIPTION_ID` | Azure subscription ID |

## GitHub Variables

Configure these under **Settings → Secrets and variables → Actions → Variables**:

| Variable | Description | Example |
|---|---|---|
| `AZURE_CONTAINER_REGISTRY_NAME` | ACR name (not the full `.azurecr.io` URL) | `azacrabc123` |
| `AZURE_APP_SERVICE_NAME` | App Service name | `azappabc123` |
| `AZURE_RESOURCE_GROUP` | Resource group containing the App Service | `rg-zava-storefront` |

> **Tip**: The actual resource names are generated by the Bicep templates using a `resourceToken`. After deploying infrastructure, find the names in the Azure Portal or via `az resource list --resource-group <rg-name> --output table`.
